{"ast":null,"code":"import _objectSpread from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{connect}from'react-redux';import{Button,Form,Upload,Input,Card,message}from'antd';import{UploadOutlined,CheckOutlined}from'@ant-design/icons';import{withRouter}from'react-router-dom';import{submitRequests}from'../../api';import{unCacheUser}from'../../redux/actions/user';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var formItemLayout={labelCol:{span:6},wrapperCol:{span:14}};var RequestSubmit=/*#__PURE__*/function(_Component){_inherits(RequestSubmit,_Component);var _super=_createSuper(RequestSubmit);function RequestSubmit(){var _this;_classCallCheck(this,RequestSubmit);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.form=/*#__PURE__*/React.createRef();_this.normFile=function(e){console.log('Upload event:',e,_this.form.current);var file=e.file,fileList=e.fileList;if(e.file.status==='done'){if(e.file.response.code===0&&e.file.response.data!==null){message.success('File upload successful');var _e$file$response$data=e.file.response.data,name=_e$file$response$data.name,url=_e$file$response$data.url;file=fileList[fileList.length-1];file.name=name;file.url=url;}else if(e.file.response.code===405){_this.props.unCacheUser();_this.props.history.replace('/launch');}else{console.log('test1');console.log(_this.form.current.getFieldValue('upload'));_this.form.current.setFieldsValue({upload:[]});console.log(_this.form.current.getFieldValue('upload'));message.error('File upload failed, reason: '+e.file.response.msg);e.file={};e.fileList=[];console.log('test2');}}else if(e.file.status==='error'){_this.form.current.setFieldsValue({upload:[]});message.error('File upload failed, please retry!');}if(Array.isArray(e)){return e;}return e&&e.fileList;};_this.onFinish=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log('Received values of form: ',values);if(!(values.upload===undefined||values.upload.length===0)){_context.next=5;break;}message.warn(\"Please upload your request file!\");_context.next=9;break;case 5:_context.next=7;return submitRequests(_this.requestType,values.upload,values.comment);case 7:response=_context.sent;if(response.code===0){message.success(response.data);_this.form.current.setFieldsValue({comment:\"\",upload:[]});}else{message.error(response.msg+\":\"+response.data);}case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();return _this;}_createClass(RequestSubmit,[{key:\"render\",value:function render(){var _this2=this;var _ref2=this.props.location.state||{},requestType=_ref2.requestType;this.requestType=requestType;var title=this.requestType==='global'?'Submit Global International Mobility Proxy Forms':'Submit Domestic Mobility Proxy Forms';var pathName=this.requestType==='global'?'/dashboard/gi-check':'/dashboard/do-check';var extra=/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(CheckOutlined,{}),onClick:function onClick(){return _this2.props.history.push({pathname:pathName,state:{requestType:_this2.requestType}});},children:\"Check\"});return/*#__PURE__*/_jsx(Card,{title:title,extra:extra,children:/*#__PURE__*/_jsxs(Form,_objectSpread(_objectSpread({name:\"validate_other\"},formItemLayout),{},{onFinish:this.onFinish,ref:this.form,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"upload\",label:\"Upload\",valuePropName:\"fileList\",getValueFromEvent:this.normFile,extra:\"Upload proxy forms data\",children:/*#__PURE__*/_jsx(Upload,{name:\"requestFile\",action:\"/mobility/upload\",listType:\"text\",accept:\".xls, .xlsx\",maxCount:1,children:/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(UploadOutlined,{}),children:\"Click to upload\"})})}),/*#__PURE__*/_jsx(Form.Item,{name:\"comment\",label:\"Comment\",children:/*#__PURE__*/_jsx(Input.TextArea,{allowClear:true})}),/*#__PURE__*/_jsx(Form.Item,{wrapperCol:{span:12,offset:6},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",children:\"Submit\"})})]}))});}}]);return RequestSubmit;}(Component);export default connect(function(state){return{};},{unCacheUser:unCacheUser})(withRouter(RequestSubmit));","map":{"version":3,"sources":["C:/Users/TaoHu/Desktop/前端/workspace/react-admin-client/src/containers/DashboardContent/RequestSubmit.jsx"],"names":["React","Component","connect","Button","Form","Upload","Input","Card","message","UploadOutlined","CheckOutlined","withRouter","submitRequests","unCacheUser","formItemLayout","labelCol","span","wrapperCol","RequestSubmit","form","createRef","normFile","e","console","log","current","file","fileList","status","response","code","data","success","name","url","length","props","history","replace","getFieldValue","setFieldsValue","upload","error","msg","Array","isArray","onFinish","values","undefined","warn","requestType","comment","location","state","title","pathName","extra","push","pathname","offset"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Button, Form, Upload, Input, Card, message } from 'antd'\r\nimport { UploadOutlined, CheckOutlined } from '@ant-design/icons';\r\nimport { withRouter } from 'react-router-dom'\r\nimport { submitRequests } from '../../api'\r\nimport { unCacheUser } from '../../redux/actions/user'\r\n\r\nconst formItemLayout = {\r\n    labelCol: { span: 6 },\r\n    wrapperCol: { span: 14 },\r\n};\r\n\r\n\r\nclass RequestSubmit extends Component {\r\n\r\n    form = React.createRef()\r\n\r\n    //handle the single file upload\r\n    normFile = (e) => {\r\n        console.log('Upload event:', e, this.form.current);\r\n        let { file, fileList } = e;\r\n\r\n        if (e.file.status === 'done') {\r\n            if (e.file.response.code === 0 && e.file.response.data !== null) {\r\n                message.success('File upload successful')\r\n                const { name, url } = e.file.response.data\r\n                file = fileList[fileList.length - 1]\r\n                file.name = name\r\n                file.url = url\r\n            } else if (e.file.response.code === 405) {\r\n                this.props.unCacheUser()\r\n                this.props.history.replace('/launch')\r\n            } else {\r\n                console.log('test1')\r\n                console.log(this.form.current.getFieldValue('upload'))\r\n                this.form.current.setFieldsValue({ upload: [] })\r\n                console.log(this.form.current.getFieldValue('upload'))\r\n                message.error('File upload failed, reason: '+e.file.response.msg)\r\n                e.file = {}\r\n                e.fileList = []\r\n                console.log('test2')\r\n            }\r\n        } else if (e.file.status === 'error') {\r\n            this.form.current.setFieldsValue({ upload: [] })\r\n            message.error('File upload failed, please retry!')\r\n        }\r\n\r\n        if (Array.isArray(e)) {\r\n            return e;\r\n        }\r\n        return e && e.fileList;\r\n    };\r\n\r\n    //submit the form data to back end to process\r\n    onFinish = async (values) => {\r\n        console.log('Received values of form: ', values);\r\n        if(values.upload === undefined || values.upload.length === 0){\r\n            message.warn(\"Please upload your request file!\")\r\n        }else{\r\n            let response = await submitRequests(this.requestType, values.upload, values.comment)\r\n            if (response.code === 0) {\r\n                message.success(response.data)\r\n                this.form.current.setFieldsValue({ comment: \"\", upload: [] })\r\n            } else {\r\n                message.error(response.msg + \":\" + response.data)\r\n            }\r\n        }\r\n    };\r\n\r\n    render() {\r\n        let {requestType} = this.props.location.state || {}\r\n        this.requestType = requestType\r\n\r\n        const title = this.requestType === 'global' ? \r\n                                           'Submit Global International Mobility Proxy Forms' :\r\n                                           'Submit Domestic Mobility Proxy Forms';\r\n\r\n        const pathName = this.requestType === 'global' ? '/dashboard/gi-check' : '/dashboard/do-check';\r\n        const extra = (<Button type=\"primary\" icon={<CheckOutlined />} onClick={() => this.props.history.push({pathname:pathName,state:{requestType:this.requestType}})}>Check</Button>)\r\n\r\n        return (\r\n            <Card title={title} extra={extra}>\r\n                <Form name=\"validate_other\" {...formItemLayout} onFinish={this.onFinish} ref={this.form}>\r\n                    {/* parameter name is identifying the file-name parm sent to back end */}\r\n                    <Form.Item\r\n                        name=\"upload\"\r\n                        label=\"Upload\"\r\n                        valuePropName=\"fileList\"\r\n                        getValueFromEvent={this.normFile}\r\n                        extra=\"Upload proxy forms data\"\r\n                    >\r\n                        {/* backend should upload the file to oss server and return the result below\r\n                            {\r\n                                \"status\": 0,\r\n                                \"data\": {\r\n                                    \"name\": \"file-xxxxxxxx\",\r\n                                    \"url\": \"http://xxxxxxxxx\"\r\n                                }\r\n                            }\r\n                        */}\r\n                        <Upload name=\"requestFile\" action=\"/mobility/upload\" listType=\"text\" accept=\".xls, .xlsx\" maxCount={1}>\r\n                            <Button icon={<UploadOutlined />}>Click to upload</Button>\r\n                        </Upload>\r\n                    </Form.Item>\r\n\r\n                    <Form.Item name=\"comment\" label=\"Comment\">\r\n                        <Input.TextArea allowClear={true} />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item wrapperCol={{ span: 12, offset: 6 }}>\r\n                        <Button type=\"primary\" htmlType=\"submit\">\r\n                            Submit\r\n                    </Button>\r\n                    </Form.Item>\r\n                </Form>\r\n            </Card>\r\n        )\r\n    }\r\n}\r\n\r\nexport default connect(\r\n    state => ({}),\r\n    { unCacheUser }\r\n)(withRouter(RequestSubmit))\r\n"]},"metadata":{},"sourceType":"module"}