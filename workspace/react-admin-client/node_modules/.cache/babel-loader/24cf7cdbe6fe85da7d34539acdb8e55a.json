{"ast":null,"code":"import _objectSpread from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/TaoHu/Desktop/\\u524D\\u7AEF/workspace/react-admin-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";var _this=this;import React,{Component}from'react';import{connect}from'react-redux';import{Button,Form,Upload,Input,Card,message}from'antd';import{UploadOutlined,CheckOutlined}from'@ant-design/icons';import{withRouter}from'react-router-dom';import{submitRequests}from'../../api';import{unCacheUser}from'../../redux/actions/user';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var formItemLayout={labelCol:{span:6},wrapperCol:{span:14}};//handle the single file upload\nvar normFile=function normFile(e){console.log('Upload event:',e);var file=e.file,fileList=e.fileList;if(e.file.status==='done'){if(e.file.response.code===0&&e.file.response.data!==null){message.success('File upload successful');var _e$file$response$data=e.file.response.data,name=_e$file$response$data.name,url=_e$file$response$data.url;file=fileList[fileList.length-1];file.name=name;file.url=url;}else if(e.file.response.code===405){_this.props.unCacheUser();_this.props.history.replace('/launch');}else{message.error('File upload failed, please retry!');}}else if(e.file.status==='error'){message.error('File upload failed, please retry!');}if(Array.isArray(e)){return e;}return e&&e.fileList;};var DOSubmit=/*#__PURE__*/function(_Component){_inherits(DOSubmit,_Component);var _super=_createSuper(DOSubmit);function DOSubmit(){var _this2;_classCallCheck(this,DOSubmit);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this2=_super.call.apply(_super,[this].concat(args));_this2.form=/*#__PURE__*/React.createRef();_this2.onFinish=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log('Received values of form: ',values);_context.next=3;return submitRequests('domestic',values.upload,values.comment);case 3:response=_context.sent;if(response.code===0){message.success(response.data);_this2.form.current.setFieldsValue({comment:\"\",upload:[]});}else if(response.code===405){_this2.props.unCacheUser();_this2.props.history.replace('/launch');}else{message.error(response.msg+\":\"+response.data);}case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();return _this2;}_createClass(DOSubmit,[{key:\"render\",value:function render(){var _this3=this;var title='Submit Domestic Mobility Proxy Forms';var extra=/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(CheckOutlined,{}),onClick:function onClick(){return _this3.props.history.push('/dashboard/do-check');},children:\"Check\"});return/*#__PURE__*/_jsx(Card,{title:title,extra:extra,children:/*#__PURE__*/_jsxs(Form,_objectSpread(_objectSpread({name:\"validate_other\"},formItemLayout),{},{onFinish:this.onFinish,ref:this.form,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"upload\",label:\"Upload\",valuePropName:\"fileList\",getValueFromEvent:normFile,extra:\"Upload proxy forms data\",children:/*#__PURE__*/_jsx(Upload,{name:\"requestFile\",action:\"/domestic/upload\",listType:\"text\",accept:\".xls, .xlsx\",maxCount:1,children:/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(UploadOutlined,{}),children:\"Click to upload\"})})}),/*#__PURE__*/_jsx(Form.Item,{name:\"comment\",label:\"Comment\",children:/*#__PURE__*/_jsx(Input.TextArea,{allowClear:true})}),/*#__PURE__*/_jsx(Form.Item,{wrapperCol:{span:12,offset:6},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",children:\"Submit\"})})]}))});}}]);return DOSubmit;}(Component);export default connect(function(state){return{};},{unCacheUser:unCacheUser})(withRouter(DOSubmit));","map":{"version":3,"sources":["C:/Users/TaoHu/Desktop/前端/workspace/react-admin-client/src/containers/DOSubmit/DOSubmit.jsx"],"names":["React","Component","connect","Button","Form","Upload","Input","Card","message","UploadOutlined","CheckOutlined","withRouter","submitRequests","unCacheUser","formItemLayout","labelCol","span","wrapperCol","normFile","e","console","log","file","fileList","status","response","code","data","success","name","url","length","props","history","replace","error","Array","isArray","DOSubmit","form","createRef","onFinish","values","upload","comment","current","setFieldsValue","msg","title","extra","push","offset","state"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Button, Form, Upload, Input, Card, message } from 'antd'\r\nimport { UploadOutlined, CheckOutlined } from '@ant-design/icons';\r\nimport { withRouter } from 'react-router-dom'\r\nimport { submitRequests } from '../../api'\r\nimport { unCacheUser } from '../../redux/actions/user'\r\n\r\nconst formItemLayout = {\r\n    labelCol: { span: 6 },\r\n    wrapperCol: { span: 14 },\r\n};\r\n\r\n//handle the single file upload\r\nconst normFile = (e) => {\r\n    console.log('Upload event:', e);\r\n    let { file, fileList } = e;\r\n\r\n    if (e.file.status === 'done') {\r\n        if (e.file.response.code === 0 && e.file.response.data !== null) {\r\n            message.success('File upload successful')\r\n            const { name, url } = e.file.response.data\r\n            file = fileList[fileList.length - 1]\r\n            file.name = name\r\n            file.url = url\r\n        }else if(e.file.response.code === 405){\r\n            this.props.unCacheUser()\r\n            this.props.history.replace('/launch')   \r\n        }else{\r\n            message.error('File upload failed, please retry!')\r\n        }\r\n    } else if (e.file.status === 'error') {\r\n        message.error('File upload failed, please retry!')\r\n    }\r\n\r\n    if (Array.isArray(e)) {\r\n        return e;\r\n    }\r\n    return e && e.fileList;\r\n};\r\n\r\nclass DOSubmit extends Component {\r\n\r\n    form = React.createRef()\r\n\r\n    //submit the form data to back end to process\r\n    onFinish = async (values) => {\r\n        console.log('Received values of form: ', values);\r\n        let response = await submitRequests('domestic', values.upload, values.comment)\r\n        if (response.code === 0) {\r\n            message.success(response.data)\r\n            this.form.current.setFieldsValue({ comment: \"\", upload: [] })\r\n        } else if(response.code === 405){\r\n            this.props.unCacheUser()\r\n            this.props.history.replace('/launch')   \r\n        }else {\r\n            message.error(response.msg + \":\" + response.data)\r\n        }\r\n    };\r\n\r\n    render() {\r\n        const title = 'Submit Domestic Mobility Proxy Forms';\r\n        const extra = (<Button type=\"primary\" icon={<CheckOutlined />} onClick={() => this.props.history.push('/dashboard/do-check')}>Check</Button>)\r\n\r\n        return (\r\n            <Card title={title} extra={extra}>\r\n                <Form name=\"validate_other\" {...formItemLayout} onFinish={this.onFinish} ref={this.form}>\r\n                    {/* parameter name is identifying the file-name parm sent to back end */}\r\n                    <Form.Item\r\n                        name=\"upload\"\r\n                        label=\"Upload\"\r\n                        valuePropName=\"fileList\"\r\n                        getValueFromEvent={normFile}\r\n                        extra=\"Upload proxy forms data\"\r\n                    >\r\n                        {/* backend should upload the file to oss server and return the result below\r\n                            {\r\n                                \"status\": 0,\r\n                                \"data\": {\r\n                                    \"name\": \"file-xxxxxxxx\",\r\n                                    \"url\": \"http://xxxxxxxxx\"\r\n                                }\r\n                            }\r\n                        */}\r\n                        <Upload name=\"requestFile\" action=\"/domestic/upload\" listType=\"text\" accept=\".xls, .xlsx\" maxCount={1}>\r\n                            <Button icon={<UploadOutlined />}>Click to upload</Button>\r\n                        </Upload>\r\n                    </Form.Item>\r\n\r\n                    <Form.Item name=\"comment\" label=\"Comment\">\r\n                        <Input.TextArea allowClear={true} />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item wrapperCol={{ span: 12, offset: 6 }}>\r\n                        <Button type=\"primary\" htmlType=\"submit\">\r\n                            Submit\r\n                    </Button>\r\n                    </Form.Item>\r\n                </Form>\r\n            </Card>\r\n        )\r\n    }\r\n}\r\n\r\nexport default connect(\r\n    state => ({}),\r\n    {unCacheUser}\r\n)(withRouter(DOSubmit))\r\n\r\n"]},"metadata":{},"sourceType":"module"}